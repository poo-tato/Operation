<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>iArch Studio Cloud</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        body { background-color: #f8fafc; color: #334155; font-family: 'Pretendard', sans-serif; margin: 0; padding: 60px 20px; display: flex; justify-content: center; }
        .main-wrapper { width: 100%; max-width: 850px; display: none; } /* Î°úÍ∑∏Ïù∏ Ï†Ñ Ïà®ÍπÄ */

        /* Î°úÍ∑∏Ïù∏ ÏÑπÏÖò */
        #auth-section { text-align: center; margin-top: 15vh; }
        .login-btn { background: #0f172a; color: white; border: none; padding: 16px 32px; border-radius: 14px; font-weight: 700; cursor: pointer; font-size: 16px; }

        .header { margin-bottom: 40px; display: flex; justify-content: space-between; align-items: flex-end; }
        .header h1 { font-size: 36px; font-weight: 800; color: #0f172a; margin: 0; letter-spacing: -1px; }
        .header p { color: #94a3b8; margin-top: 8px; font-size: 15px; }

        .summary-bar { display: flex; gap: 40px; margin-bottom: 30px; padding: 15px 5px; border-bottom: 2px solid #f1f5f9; }
        .summary-item b { color: #6366f1; font-size: 24px; font-weight: 800; }
        .summary-item span { font-size: 14px; color: #64748b; margin-left: 8px; font-weight: 600; }

        .search-box { margin-bottom: 20px; position: relative; }
        .search-box input { width: 100%; box-sizing: border-box; border: 2px solid #e2e8f0; background: #fff; padding: 12px 18px 12px 45px; border-radius: 14px; font-size: 14px; outline: none; }
        .search-box::before { content: "üîç"; position: absolute; left: 18px; top: 12px; font-size: 16px; opacity: 0.5; }

        .input-card { background: white; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.04); display: flex; gap: 12px; margin-bottom: 30px; border: 1px solid #f1f5f9; }
        .input-card input { flex: 1; border: 1px solid #e2e8f0; background: #fff; padding: 14px 18px; border-radius: 14px; font-size: 14px; outline: none; }
        .add-btn { background: #0f172a; color: white; border: none; padding: 0 30px; border-radius: 14px; font-weight: 700; cursor: pointer; }

        .item { background: white; margin-bottom: 14px; padding: 22px; border-radius: 20px; display: flex; align-items: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02); border: 1px solid #f1f5f9; }
        .info { flex: 1; }
        .info .title { font-weight: 700; font-size: 17px; color: #1e293b; display: block; }
        .info .client { font-size: 13px; color: #94a3b8; margin-top: 4px; display: flex; gap: 10px; }

        .price { font-weight: 800; margin-right: 25px; color: #334155; font-size: 16px; }
        select { border: 1px solid #e2e8f0; background: #f8fafc; padding: 8px 12px; border-radius: 10px; font-size: 13px; font-weight: 700; outline: none; }
        .st-w { color: #94a3b8; } .st-i { color: #6366f1; border-color: #c7d2fe; background: #eef2ff; } .st-d { color: #10b981; border-color: #a7f3d0; background: #ecfdf5; } 
        .btn-del { margin-left: 20px; background: none; border: none; color: #cbd5e1; cursor: pointer; font-size: 13px; }
    </style>
</head>
<body>

<div id="auth-section">
    <h1>iArch Console</h1>
    <p style="color:#94a3b8; margin-bottom:30px;">Cloud Production Mode</p>
    <button class="login-btn" onclick="login()">Google Login</button>
</div>

<div class="main-wrapper" id="main-wrapper">
    <div class="header">
        <div>
            <h1 onclick="logout()" style="cursor:pointer">Îèà ÎßéÏù¥ Î≤åÏûê üí∏</h1>
            <p>iArch Studio Operation Ledger (Cloud)</p>
        </div>
        <div id="clock" style="font-size: 13px; color: #cbd5e1; font-family: monospace;"></div>
    </div>

    <div class="summary-bar">
        <div class="summary-item"><b id="count-active">0</b><span>ÏßÑÌñâ Ï§ë</span></div>
        <div class="summary-item"><b id="sum-revenue">0Ïõê</b><span>ÎàÑÏ†Å Îß§Ï∂ú</span></div>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" onkeyup="renderList()" placeholder="ÌîÑÎ°úÏ†ùÌä∏Î™Ö ÎòêÎäî Í≥†Í∞ù ÎãâÎÑ§ÏûÑ Í≤ÄÏÉâ...">
    </div>

    <div class="input-card">
        <input type="text" id="p" placeholder="ÌîÑÎ°úÏ†ùÌä∏Î™Ö">
        <input type="text" id="c" placeholder="Í≥†Í∞ù ÎãâÎÑ§ÏûÑ">
        <input type="number" id="v" placeholder="Í∏àÏï°">
        <button class="add-btn" onclick="add()">DEPLOY</button>
    </div>

    <div id="list"></div>
</div>

<script>
    // ‚ö†Ô∏è ÌååÏù¥Ïñ¥Î≤†Ïù¥Ïä§ ÏΩòÏÜîÏóêÏÑú Î≥µÏÇ¨Ìïú ÏÑ§Ï†ïÏùÑ Ïó¨Í∏∞Ïóê ÎÑ£ÏúºÏÑ∏Ïöî
        const firebaseConfig = {
        apiKey: "AIzaSyAP1bV3mqVQBPZn1CV_YQ0BlboJiIDkATs",
        authDomain: "operation-502d9.firebaseapp.com",
        projectId: "operation-502d9",
        storageBucket: "operation-502d9.firebasestorage.app",
        messagingSenderId: "1087720589398",
        appId: "1:1087720589398:web:85cebf4484eae1755d53f7",
        measurementId: "G-50G9TKQ9CH"
        };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    let projects = [];

    // Î°úÍ∑∏Ïù∏ Ìï∏Îì§Îü¨
    auth.onAuthStateChanged(user => {
        if (user) {
            // Î≥∏Ïù∏ Ïù¥Î©îÏùºÎßå ÌóàÏö©ÌïòÍ≥† Ïã∂Îã§Î©¥ ÏïÑÎûò Ï£ºÏÑù Ìï¥Ï†ú
            // if(user.email !== "your-email@gmail.com") { alert("Access Denied"); logout(); return; }
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-wrapper').style.display = 'block';
            syncData();
        } else {
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('main-wrapper').style.display = 'none';
        }
    });

    function login() { auth.signInWithPopup(provider); }
    function logout() { auth.signOut(); }

    // Îç∞Ïù¥ÌÑ∞ Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî
    function syncData() {
        db.collection("iarch_ledger").orderBy("fullDate", "desc").onSnapshot(snapshot => {
            projects = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderList();
        });
    }

    function renderList() {
        const list = document.getElementById('list');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        list.innerHTML = '';
        
        const filtered = projects.filter(o => o.p.toLowerCase().includes(searchTerm) || o.c.toLowerCase().includes(searchTerm));

        filtered.forEach(o => {
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="info">
                    <span class="title">${o.p}</span>
                    <span class="client"><span>üë§ ${o.c}</span><span>üìÖ ${o.date}</span></span>
                </div>
                <div class="price">‚Ç©${Number(o.v).toLocaleString()}</div>
                <select onchange="updateStatus('${o.id}', this.value)" class="st-${o.s}">
                    <option value="w" ${o.s==='w'?'selected':''}>Pending</option>
                    <option value="i" ${o.s==='i'?'selected':''}>Running</option>
                    <option value="d" ${o.s==='d'?'selected':''}>Success</option>
                </select>
                <button class="btn-del" onclick="remove('${o.id}')">ÏÇ≠Ï†ú</button>
            `;
            list.appendChild(div);
        });
        updateStats();
    }

    function updateStats() {
        const active = projects.filter(o => o.s !== 'd').length;
        const rev = projects.filter(o => o.s === 'd').reduce((a, b) => a + Number(b.v), 0);
        document.getElementById('count-active').innerText = active;
        document.getElementById('sum-revenue').innerText = rev.toLocaleString() + 'Ïõê';
    }

    function add() {
        const p=document.getElementById('p'), c=document.getElementById('c'), v=document.getElementById('v');
        if(!p.value || !c.value || !v.value) return;
        const now = new Date();
        db.collection("iarch_ledger").add({
            p: p.value, c: c.value, v: v.value, s: 'w',
            date: `${now.getMonth()+1}/${now.getDate()}`,
            fullDate: now.toISOString()
        });
        p.value=''; c.value=''; v.value='';
    }

    function updateStatus(id, val) { db.collection("iarch_ledger").doc(id).update({ s: val }); }
    function remove(id) { if(confirm('Drop this project?')) db.collection("iarch_ledger").doc(id).delete(); }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>

</body>
</html>
