<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>iArch Studio | 3D Cloud Console</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        :root {
            --primary: #6366f1; --bg: #f8fafc; --card: #ffffff;
            --text: #0f172a; --sub-text: #64748b; --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body.theme-dark { --primary: #818cf8; --bg: #020617; --card: #1e293b; --text: #f1f5f9; --sub-text: #94a3b8; --border: #334155; --shadow: rgba(0, 0, 0, 0.5); }
        body.theme-cyber { --primary: #00ff41; --bg: #000000; --card: #0d0d0d; --text: #00ff41; --sub-text: #008f11; --border: #003b00; --shadow: rgba(0, 255, 65, 0.2); }

        body { 
            background-color: var(--bg); color: var(--text); font-family: 'Pretendard', sans-serif; 
            margin: 0; padding: 40px 20px; transition: 0.5s; overflow-x: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><text y="20" font-size="20">ğŸ’°</text></svg>'), auto;
        }

        .main-wrapper { width: 100%; max-width: 1200px; margin: 0 auto; display: none; }

        /* âœ¨ 3D ë ˆì´ì•„ì›ƒ ì„¤ì • */
        #list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 40px;
            padding: 40px 0;
            perspective: 2000px; /* ì›ê·¼ê° ê¹Šì´ */
        }

        /* âœ¨ 3D ì¹´ë“œ ë””ìì¸ */
        .item { 
            background: var(--card); border: 1px solid var(--border); border-radius: 24px;
            padding: 30px; position: relative;
            transform-style: preserve-3d;
            transform: rotateX(10deg) rotateY(-10deg);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 0 20px 40px var(--shadow);
        }

        .item:hover {
            transform: rotateX(0deg) rotateY(0deg) translateZ(50px);
            box-shadow: 0 40px 80px var(--shadow);
            border-color: var(--primary);
        }

        /* ì¹´ë“œ ë‚´ë¶€ ìš”ì†Œ ì…ì²´ê° */
        .info { transform: translateZ(30px); }
        .price { transform: translateZ(40px); font-size: 26px; font-weight: 900; color: var(--primary); margin: 20px 0; }
        .action-group { transform: translateZ(25px); display: flex; gap: 10px; justify-content: flex-end; align-items: center; }

        /* ìƒíƒœ ì¸ë””ì¼€ì´í„° (ë„¤ì˜¨ ë¼ì¸) */
        .status-light {
            position: absolute; top: 30px; left: 0; width: 6px; height: 40px; border-radius: 0 4px 4px 0;
            box-shadow: 0 0 15px currentColor;
        }

        /* ìƒë‹¨ ëŒ€ì‹œë³´ë“œ (Glassmorphism) */
        .glass-header {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid var(--border); border-radius: 30px; padding: 30px;
            display: grid; grid-template-columns: 1fr 2fr; gap: 30px; margin-bottom: 40px;
        }

        .stat-box { text-align: center; }
        .stat-box label { font-size: 13px; font-weight: 800; color: var(--sub-text); text-transform: uppercase; letter-spacing: 1px; }
        .stat-box b { font-size: 32px; display: block; margin-top: 5px; }

        /* ì…ë ¥ í¼ ë””ìì¸ */
        .input-card { 
            background: var(--card); border: 1px solid var(--border); border-radius: 20px;
            padding: 10px; display: flex; gap: 10px; margin-bottom: 20px;
        }
        .input-card input { 
            flex: 1; border: none; background: transparent; color: var(--text);
            padding: 15px; font-size: 15px; outline: none;
        }
        .add-btn { background: var(--primary); color: white; border: none; padding: 0 30px; border-radius: 15px; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .add-btn:hover { transform: scale(1.05); filter: brightness(1.2); }

        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        .coin-effect { position: fixed; pointer-events: none; font-size: 24px; animation: coin-up 0.8s forwards; z-index: 9999; }
        @keyframes coin-up { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-100px) scale(2); opacity: 0; } }
        
        #cmd-palette {
            display: none; position: fixed; top: 15%; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 550px; background: var(--card); border: 2px solid var(--primary);
            border-radius: 24px; z-index: 10000; padding: 30px; box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }

        .st-select { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 8px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body class="theme-default">

<div id="cmd-palette">
    <div style="font-size:12px; color:var(--primary); font-weight:900; margin-bottom:15px; letter-spacing:2px;">ğŸš€ SYSTEM COMMAND</div>
    <input type="text" id="cmd-input" placeholder="/add í”„ë¡œì íŠ¸,ê³ ê°,ê¸ˆì•¡ ..." style="width:100%; border:none; background:transparent; font-size:22px; color:var(--text); outline:none;">
</div>

<div id="auth-section" style="text-align: center; margin-top: 30vh;">
    <h1 style="font-size: 40px; font-weight: 900;">iArch Studio <span style="color:var(--primary)">3D</span></h1>
    <button class="login-btn" onclick="login()" style="background:var(--text); color:var(--bg); padding: 20px 40px; border-radius: 20px; border:none; cursor:pointer; font-weight:800;">Google Console Login</button>
</div>

<div class="main-wrapper" id="main-wrapper">
    <div class="header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px;">
        <h1 style="font-weight: 900; font-size: 32px; margin:0;" onclick="logout()">iArch ğŸ’¸</h1>
        <select class="theme-select" onchange="changeTheme(this.value)" id="themeSelector" style="padding:10px; border-radius:12px;">
            <option value="default">ğŸŒ Light Mode</option>
            <option value="dark">ğŸŒ‘ Dark Vision</option>
            <option value="cyber">ğŸ‘½ Cyber Engine</option>
        </select>
    </div>

    <div class="glass-header">
        <div class="stat-box">
            <label>Total Revenue</label>
            <b id="sum-revenue">0ì›</b>
        </div>
        <div class="stat-box">
            <label>Operations Progress (<span id="active-info">0</span> Active)</label>
            <b id="progress-percent" style="color:var(--primary)">0%</b>
            <div style="width:100%; height:8px; background:var(--border); border-radius:10px; margin-top:15px; overflow:hidden;">
                <div id="progress-bar" style="height:100%; width:0%; background:var(--primary); transition:1s;"></div>
            </div>
        </div>
    </div>

    <div class="input-card">
        <input type="text" id="p" placeholder="Project Name">
        <input type="text" id="c" placeholder="Client">
        <input type="number" id="v" placeholder="Amount">
        <button class="add-btn" onclick="add()">DEPLOY</button>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" onkeyup="renderList()" placeholder="Quick Search Workspace..." 
               style="width:100%; padding:20px; border-radius:20px; border:1px solid var(--border); background:var(--card); color:var(--text); outline:none; margin-bottom:30px;">
    </div>

    <div id="list"></div>
</div>

<script>
    // [ê¸°ì¡´ íŒŒì´ì–´ë² ì´ìŠ¤ ë° íš¨ê³¼ ë¡œì§ ìœ ì§€]
    function playCoinSound() {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const osc = context.createOscillator();
        const gain = context.createGain();
        osc.type = 'sine'; osc.frequency.setValueAtTime(1200, context.currentTime);
        gain.gain.setValueAtTime(0.1, context.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
        osc.connect(gain); gain.connect(context.destination);
        osc.start(); osc.stop(context.currentTime + 0.3);
    }

    window.addEventListener('click', (e) => {
        try { playCoinSound(); } catch(err) {}
        const coin = document.createElement('div');
        coin.className = 'coin-effect';
        coin.innerText = 'ğŸª™';
        coin.style.left = e.clientX + 'px';
        coin.style.top = e.clientY + 'px';
        document.body.appendChild(coin);
        setTimeout(() => coin.remove(), 800);
    });

    const firebaseConfig = {
        apiKey: "AIzaSyAP1bV3mqVQBPZn1CV_YQ0BlboJiIDkATs",
        authDomain: "operation-502d9.firebaseapp.com",
        projectId: "operation-502d9",
        storageBucket: "operation-502d9.firebasestorage.app",
        messagingSenderId: "1087720589398",
        appId: "1:1087720589398:web:85cebf4484eae1755d53f7",
        measurementId: "G-50G9TKQ9CH"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    let projects = [];

    function changeTheme(theme) {
        document.body.className = theme === 'default' ? '' : 'theme-' + theme;
        localStorage.setItem('iarch-theme', theme);
    }
    changeTheme(localStorage.getItem('iarch-theme') || 'default');

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-wrapper').style.display = 'block';
            syncData();
        }
    });

    function login() { auth.signInWithPopup(provider); }
    function logout() { if(confirm('Logout?')) auth.signOut().then(()=>location.reload()); }

    function syncData() {
        db.collection("iarch_ledger").orderBy("fullDate", "desc").onSnapshot(snapshot => {
            projects = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderList();
        });
    }

    // âœ¨ 3D íƒ€ì¼ ë Œë”ë§ ë¡œì§
    function renderList() {
        const list = document.getElementById('list');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        list.innerHTML = '';
        const filtered = projects.filter(o => o.p.toLowerCase().includes(searchTerm) || o.c.toLowerCase().includes(searchTerm));
        
        filtered.forEach(o => {
            const statusColor = o.s === 'd' ? '#10b981' : (o.s === 'i' ? '#6366f1' : '#64748b');
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="status-light" style="color:${statusColor}; background-color:currentColor;"></div>
                <div class="info">
                    <div style="font-size:12px; color:var(--sub-text); margin-bottom:5px; font-weight:800;">${o.date}</div>
                    <div class="title" style="font-size:20px; font-weight:900;">${o.p}</div>
                    <div style="color:var(--sub-text); margin-top:5px;">ğŸ‘¤ ${o.c}</div>
                </div>
                <div class="price">â‚©${Number(o.v).toLocaleString()}</div>
                <div class="action-group">
                    <select onchange="updateStatus('${o.id}', this.value)" class="st-select">
                        <option value="w" ${o.s==='w'?'selected':''}>Pending</option>
                        <option value="i" ${o.s==='i'?'selected':''}>Running</option>
                        <option value="d" ${o.s==='d'?'selected':''}>Success</option>
                    </select>
                    <button onclick="remove('${o.id}')" style="background:none; border:none; color:var(--sub-text); cursor:pointer; font-size:20px;">Ã—</button>
                </div>
            `;
            list.appendChild(div);
        });
        updateStats();
    }

    function updateStats() {
        const total = projects.length, done = projects.filter(o => o.s === 'd').length, running = projects.filter(o => o.s === 'i').length;
        const rev = projects.filter(o => o.s === 'd').reduce((a, b) => a + Number(b.v), 0);
        const progress = total > 0 ? Math.round((done / total) * 100) : 0;
        document.getElementById('sum-revenue').innerText = rev.toLocaleString() + 'ì›';
        document.getElementById('progress-percent').innerText = progress + '%';
        document.getElementById('progress-bar').style.width = progress + '%';
        document.getElementById('active-info').innerText = running;
    }

    function add() {
        const p=document.getElementById('p'), c=document.getElementById('c'), v=document.getElementById('v');
        if(!p.value || !c.value || !v.value) return;
        db.collection("iarch_ledger").add({
            p: p.value, c: c.value, v: v.value, s: 'w',
            date: `${new Date().getMonth()+1}/${new Date().getDate()}`,
            fullDate: new Date().toISOString()
        });
        p.value=''; c.value=''; v.value='';
    }
    function updateStatus(id, val) { db.collection("iarch_ledger").doc(id).update({ s: val }); }
    function remove(id) { if(confirm('Delete Project?')) db.collection("iarch_ledger").doc(id).delete(); }

    // âš¡ Command Palette
    window.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            document.getElementById('cmd-palette').style.display = 'block';
            document.getElementById('cmd-input').focus();
        }
        if (e.key === 'Escape') document.getElementById('cmd-palette').style.display = 'none';
    });

    document.getElementById('cmd-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const val = e.target.value.trim();
            if (val.startsWith('/add ')) {
                const params = val.replace('/add ', '').split(',');
                if (params.length === 3) {
                    db.collection("iarch_ledger").add({
                        p: params[0].trim(), c: params[1].trim(), v: params[2].trim(), s: 'w',
                        date: `${new Date().getMonth()+1}/${new Date().getDate()}`,
                        fullDate: new Date().toISOString()
                    });
                    document.getElementById('cmd-palette').style.display = 'none';
                    e.target.value = '';
                }
            } else {
                document.getElementById('searchInput').value = val;
                renderList();
                document.getElementById('cmd-palette').style.display = 'none';
            }
        }
    });
</script>
</body>
</html>
