<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>iArch Studio Cloud</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        body { background-color: #f1f5f9; color: #334155; font-family: 'Pretendard', sans-serif; margin: 0; padding: 40px 20px; display: flex; justify-content: center; }
        .main-wrapper { width: 100%; max-width: 850px; display: none; }

        #auth-section { text-align: center; margin-top: 20vh; }
        .login-btn { background: #0f172a; color: white; border: none; padding: 16px 32px; border-radius: 14px; font-weight: 700; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }

        .header { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 28px; font-weight: 800; color: #0f172a; margin: 0; cursor: pointer; }
        #clock { font-size: 14px; color: #64748b; font-weight: 600; background: #fff; padding: 6px 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* ÎåÄÏãúÎ≥¥Îìú Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .dashboard { display: grid; grid-template-columns: 1fr 1.5fr; gap: 15px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .stat-card label { display: block; font-size: 13px; color: #94a3b8; font-weight: 700; margin-bottom: 8px; }
        .stat-card b { font-size: 24px; color: #0f172a; }

        /* ÏßÑÌñâÎ•† Î∞î */
        .progress-container { width: 100%; height: 10px; background: #e2e8f0; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        #progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #6366f1, #a855f7); transition: 0.5s; }

        .search-box { margin-bottom: 20px; position: relative; }
        .search-box input { width: 100%; box-sizing: border-box; border: 2px solid #e2e8f0; background: #fff; padding: 14px 18px 14px 45px; border-radius: 16px; font-size: 14px; outline: none; transition: 0.2s; }
        .search-box input:focus { border-color: #6366f1; }
        .search-box::before { content: "üîç"; position: absolute; left: 18px; top: 14px; font-size: 16px; opacity: 0.5; }

        .input-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); display: flex; gap: 10px; margin-bottom: 25px; border: 1px solid #e2e8f0; }
        .input-card input { flex: 1; border: 1px solid #f1f5f9; background: #f8fafc; padding: 12px 15px; border-radius: 12px; font-size: 14px; outline: none; }
        .input-card input:focus { background: #fff; border-color: #6366f1; }
        .add-btn { background: #6366f1; color: white; border: none; padding: 0 25px; border-radius: 12px; font-weight: 700; cursor: pointer; }

        .item { background: white; margin-bottom: 12px; padding: 18px 22px; border-radius: 20px; display: flex; align-items: center; border: 1px solid #f1f5f9; transition: 0.2s; }
        .item:hover { transform: scale(1.01); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .info { flex: 1; }
        .info .title { font-weight: 700; font-size: 16px; color: #1e293b; }
        .info .client { font-size: 12px; color: #94a3b8; margin-top: 3px; display: block; }

        .price { font-weight: 800; margin-right: 20px; color: #334155; font-size: 15px; }
        
        /* Î≤ÑÌäº/ÏÉÅÌÉú ÏÑ∏Ìä∏ */
        .actions { display: flex; align-items: center; gap: 8px; }
        select { border: 1px solid #e2e8f0; padding: 8px; border-radius: 10px; font-size: 12px; font-weight: 700; outline: none; }
        .st-w { background: #f1f5f9; color: #64748b; }
        .st-i { background: #eef2ff; color: #6366f1; border-color: #c7d2fe; }
        .st-d { background: #ecfdf5; color: #10b981; border-color: #a7f3d0; }

        .btn-copy { background: #f8fafc; border: 1px solid #e2e8f0; padding: 8px 12px; border-radius: 10px; font-size: 12px; cursor: pointer; font-weight: 600; }
        .btn-copy:hover { background: #e2e8f0; }
        .btn-del { color: #cbd5e1; border: none; background: none; cursor: pointer; font-size: 12px; margin-left: 5px; }
        .btn-del:hover { color: #f43f5e; }
    </style>
</head>
<body>

<div id="auth-section">
    <h1>iArch Console</h1>
    <p style="color:#94a3b8; margin-bottom:30px;">Cloud Production Mode</p>
    <button class="login-btn" onclick="login()">Google Login</button>
</div>

<div class="main-wrapper" id="main-wrapper">
    <div class="header">
        <h1 onclick="logout()">iArch Studio üí∏</h1>
        <div id="clock">00:00:00</div>
    </div>

    <div class="dashboard">
        <div class="stat-card">
            <label>ÎàÑÏ†Å Îß§Ï∂ú (ÏôÑÎ£åÍ∏∞Ï§Ä)</label>
            <b id="sum-revenue">0Ïõê</b>
        </div>
        <div class="stat-card">
            <label>Ï†ÑÏ≤¥ Í≥µÏ†ï ÏßÑÌñâÎ•†</label>
            <div style="display:flex; justify-content:space-between; align-items: flex-end;">
                <b id="progress-percent">0%</b>
                <span style="font-size:12px; color:#94a3b8;" id="active-info">0Í±¥ ÏßÑÌñâ Ï§ë</span>
            </div>
            <div class="progress-container"><div id="progress-bar"></div></div>
        </div>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" onkeyup="renderList()" placeholder="ÌîÑÎ°úÏ†ùÌä∏ ÎòêÎäî Í≥†Í∞ùÎ™Ö Í≤ÄÏÉâ...">
    </div>

    <div class="input-card">
        <input type="text" id="p" placeholder="ÌîÑÎ°úÏ†ùÌä∏Î™Ö">
        <input type="text" id="c" placeholder="Í≥†Í∞ù ÎãâÎÑ§ÏûÑ">
        <input type="number" id="v" placeholder="Í∏àÏï°">
        <button class="add-btn" onclick="add()">DEPLOY</button>
    </div>

    <div id="list"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAP1bV3mqVQBPZn1CV_YQ0BlboJiIDkATs",
        authDomain: "operation-502d9.firebaseapp.com",
        projectId: "operation-502d9",
        storageBucket: "operation-502d9.firebasestorage.app",
        messagingSenderId: "1087720589398",
        appId: "1:1087720589398:web:85cebf4484eae1755d53f7",
        measurementId: "G-50G9TKQ9CH"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    let projects = [];

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-wrapper').style.display = 'block';
            syncData();
        } else {
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('main-wrapper').style.display = 'none';
        }
    });

    function login() { auth.signInWithPopup(provider); }
    function logout() { if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) auth.signOut(); }

    function syncData() {
        db.collection("iarch_ledger").orderBy("fullDate", "desc").onSnapshot(snapshot => {
            projects = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderList();
        });
    }

    // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ìï®Ïàò
    function copyInfo(p, c, v, s) {
        const statusMsg = s === 'd' ? '‚úÖ ÏûëÏóÖ ÏôÑÎ£å' : (s === 'i' ? '‚öôÔ∏è ÏßÑÌñâ Ï§ë' : '‚è≥ ÎåÄÍ∏∞ Ï§ë');
        const text = `[iArch Studio]\nüë§ Í≥†Í∞ùÎ™Ö: ${c}\nüì¶ ÌîÑÎ°úÏ†ùÌä∏: ${p}\nüí∞ Í∏àÏï°: ‚Ç©${Number(v).toLocaleString()}\nüìå ÏÉÅÌÉú: ${statusMsg}`;
        navigator.clipboard.writeText(text).then(() => alert('Ï†ïÏÇ∞ Ï†ïÎ≥¥Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!'));
    }

    function renderList() {
        const list = document.getElementById('list');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        list.innerHTML = '';
        
        const filtered = projects.filter(o => o.p.toLowerCase().includes(searchTerm) || o.c.toLowerCase().includes(searchTerm));

        filtered.forEach(o => {
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="info">
                    <span class="title">${o.p}</span>
                    <span class="client">üë§ ${o.c} ¬∑ üìÖ ${o.date}</span>
                </div>
                <div class="price">‚Ç©${Number(o.v).toLocaleString()}</div>
                <div class="actions">
                    <button class="btn-copy" onclick="copyInfo('${o.p}', '${o.c}', '${o.v}', '${o.s}')">Copy</button>
                    <select onchange="updateStatus('${o.id}', this.value)" class="st-${o.s}">
                        <option value="w" ${o.s==='w'?'selected':''}>Pending</option>
                        <option value="i" ${o.s==='i'?'selected':''}>Running</option>
                        <option value="d" ${o.s==='d'?'selected':''}>Success</option>
                    </select>
                    <button class="btn-del" onclick="remove('${o.id}')">√ó</button>
                </div>
            `;
            list.appendChild(div);
        });
        updateStats();
    }

    function updateStats() {
        const total = projects.length;
        const done = projects.filter(o => o.s === 'd').length;
        const running = projects.filter(o => o.s === 'i').length;
        const rev = projects.filter(o => o.s === 'd').reduce((a, b) => a + Number(b.v), 0);

        const progress = total > 0 ? Math.round((done / total) * 100) : 0;
        
        document.getElementById('sum-revenue').innerText = rev.toLocaleString() + 'Ïõê';
        document.getElementById('progress-percent').innerText = progress + '%';
        document.getElementById('progress-bar').style.width = progress + '%';
        document.getElementById('active-info').innerText = `${running}Í±¥ ÏßÑÌñâ Ï§ë`;
    }

    function add() {
        const p=document.getElementById('p'), c=document.getElementById('c'), v=document.getElementById('v');
        if(!p.value || !c.value || !v.value) return;
        const now = new Date();
        db.collection("iarch_ledger").add({
            p: p.value, c: c.value, v: v.value, s: 'w',
            date: `${now.getMonth()+1}/${now.getDate()}`,
            fullDate: now.toISOString()
        });
        p.value=''; c.value=''; v.value='';
    }

    function updateStatus(id, val) { db.collection("iarch_ledger").doc(id).update({ s: val }); }
    function remove(id) { if(confirm('Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) db.collection("iarch_ledger").doc(id).delete(); }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>

</body>
</html>
