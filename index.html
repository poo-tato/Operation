<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>iArch 3D Workspace</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        :root {
            --primary: #6366f1; --bg: #0f172a; --card: rgba(30, 41, 59, 0.7);
            --text: #f8fafc; --sub-text: #94a3b8; --border: rgba(255, 255, 255, 0.1);
        }

        body { 
            background-color: var(--bg); color: var(--text); font-family: 'Pretendard', sans-serif; 
            margin: 0; padding: 40px; min-height: 100vh;
            /* 배경 그리드로 공간감 부여 */
            background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 40px 40px;
            display: flex; flex-direction: column; align-items: center;
            perspective: 1000px; /* 전역 원근감 */
        }

        .main-wrapper { width: 100%; max-width: 1200px; display: none; }

        /* ✨ 3D 카드 그리드 */
        #list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 50px;
            padding: 50px 0;
        }

        /* ✨ 3D 카드 본체 */
        .item { 
            background: var(--card); border: 1px solid var(--border); border-radius: 30px;
            padding: 35px; position: relative;
            backdrop-filter: blur(15px);
            transform-style: preserve-3d;
            transition: transform 0.1s ease; /* 마우스 추적을 위해 짧게 설정 */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* ✨ 카드 내부 요소에 높이차(Z-index) 주기 */
        .info { transform: translateZ(50px); pointer-events: none; }
        .price { 
            transform: translateZ(80px); /* 가격이 가장 앞에 튀어나옴 */
            font-size: 28px; font-weight: 900; color: #fff;
            text-shadow: 0 10px 20px rgba(0,0,0,0.3);
            margin: 20px 0;
        }
        .action-group { transform: translateZ(40px); display: flex; gap: 10px; justify-content: flex-end; }

        /* 상태에 따른 네온 글로우 */
        .status-tag {
            position: absolute; top: 20px; right: 20px; padding: 5px 12px; border-radius: 20px;
            font-size: 10px; font-weight: 800; text-transform: uppercase;
            transform: translateZ(30px);
        }

        /* 상단 통계 카드 (떠 있는 느낌) */
        .header-stats {
            display: flex; gap: 20px; margin-bottom: 50px; width: 100%;
            transform: translateZ(20px);
        }
        .stat-card {
            flex: 1; background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            padding: 25px; border-radius: 25px; text-align: center;
        }

        /* 퀵 커맨드 (오버레이) */
        #cmd-palette {
            display: none; position: fixed; top: 20%; left: 50%; transform: translate(-50%, -50%) translateZ(200px);
            width: 500px; background: #1e293b; border: 2px solid var(--primary);
            border-radius: 20px; z-index: 10000; padding: 30px; box-shadow: 0 0 100px rgba(0,0,0,0.8);
        }

        select, input { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; border-radius: 10px; padding: 10px; outline: none; }
        .add-btn { background: var(--primary); color: #fff; border: none; padding: 12px 25px; border-radius: 12px; font-weight: 800; cursor: pointer; }
    </style>
</head>
<body>

<div id="cmd-palette">
    <div style="font-size:11px; color:var(--primary); font-weight:900; margin-bottom:10px;">⚡ SYSTEM_OPERATOR</div>
    <input type="text" id="cmd-input" placeholder="/add 프로젝트,고객,금액..." style="width:100%; font-size:18px;">
</div>

<div class="main-wrapper" id="main-wrapper">
    <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:40px;">
        <h1 style="font-size:40px; font-weight:900; margin:0; letter-spacing:-1px;">iArch <span style="color:var(--primary)">Core</span></h1>
        <div id="status-display" style="font-family:monospace; color:var(--primary); font-size:12px;">SYSTEM_ACTIVE: 100%</div>
    </div>

    <div class="header-stats">
        <div class="stat-card"><label style="color:var(--sub-text); font-size:12px;">REVENUE</label><b id="sum-revenue" style="display:block; font-size:24px;">0</b></div>
        <div class="stat-card"><label style="color:var(--sub-text); font-size:12px;">ACTIVE_TASKS</label><b id="active-info" style="display:block; font-size:24px;">0</b></div>
        <div class="stat-card"><label style="color:var(--sub-text); font-size:12px;">LOAD_CAPA</label><b id="progress-percent" style="display:block; font-size:24px;">0%</b></div>
    </div>

    <div id="list"></div>
</div>

<script>
    /* --- 파이어베이스 설정 --- */
    const firebaseConfig = {
        apiKey: "AIzaSyAP1bV3mqVQBPZn1CV_YQ0BlboJiIDkATs",
        authDomain: "operation-502d9.firebaseapp.com",
        projectId: "operation-502d9",
        storageBucket: "operation-502d9.firebasestorage.app",
        messagingSenderId: "1087720589398",
        appId: "1:1087720589398:web:85cebf4484eae1755d53f7",
        measurementId: "G-50G9TKQ9CH"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let projects = [];

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('main-wrapper').style.display = 'block';
            syncData();
        } else {
            auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
        }
    });

    function syncData() {
        db.collection("iarch_ledger").orderBy("fullDate", "desc").onSnapshot(snapshot => {
            projects = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderList();
        });
    }

    /* ✨ 3D 인터랙티브 렌더링 */
    function renderList() {
        const list = document.getElementById('list');
        list.innerHTML = '';
        
        projects.forEach(o => {
            const statusText = o.s === 'd' ? 'SUCCESS' : (o.s === 'i' ? 'RUNNING' : 'PENDING');
            const statusColor = o.s === 'd' ? '#10b981' : (o.s === 'i' ? '#6366f1' : '#64748b');
            
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="status-tag" style="background:${statusColor}22; color:${statusColor}; border:1px solid ${statusColor}">${statusText}</div>
                <div class="info">
                    <div style="font-size:11px; color:var(--sub-text);">${o.date}</div>
                    <div style="font-size:22px; font-weight:800; margin-top:5px;">${o.p}</div>
                    <div style="color:var(--sub-text); margin-top:5px;">@${o.c}</div>
                </div>
                <div class="price">₩${Number(o.v).toLocaleString()}</div>
                <div class="action-group">
                    <select onchange="updateStatus('${o.id}', this.value)" class="st-select">
                        <option value="w" ${o.s==='w'?'selected':''}>Wait</option>
                        <option value="i" ${o.s==='i'?'selected':''}>Live</option>
                        <option value="d" ${o.s==='d'?'selected':''}>Done</option>
                    </select>
                </div>
            `;
            
            // ✨ 마우스 이동에 따른 실시간 3D 틸트 이벤트 추가
            div.addEventListener('mousemove', (e) => {
                const rect = div.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const xc = rect.width / 2;
                const yc = rect.height / 2;
                const dx = x - xc;
                const dy = y - yc;
                
                // 각도 계산 (최대 20도)
                div.style.transform = `rotateY(${dx / 10}deg) rotateX(${-dy / 10}deg) translateZ(20px)`;
            });

            div.addEventListener('mouseleave', () => {
                div.style.transform = `rotateY(0deg) rotateX(0deg) translateZ(0px)`;
            });

            list.appendChild(div);
        });
        updateStats();
    }

    function updateStats() {
        const total = projects.length, done = projects.filter(o => o.s === 'd').length, running = projects.filter(o => o.s === 'i').length;
        const rev = projects.filter(o => o.s === 'd').reduce((a, b) => a + Number(b.v), 0);
        document.getElementById('sum-revenue').innerText = rev.toLocaleString();
        document.getElementById('active-info').innerText = running;
        document.getElementById('progress-percent').innerText = total > 0 ? Math.round((done/total)*100)+'%' : '0%';
    }

    function updateStatus(id, val) { db.collection("iarch_ledger").doc(id).update({ s: val }); }

    /* ⚡ 퀵 커맨드 */
    window.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            const p = document.getElementById('cmd-palette');
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
            if(p.style.display === 'block') document.getElementById('cmd-input').focus();
        }
    });

    document.getElementById('cmd-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const val = e.target.value.trim();
            if (val.startsWith('/add ')) {
                const params = val.replace('/add ', '').split(',');
                db.collection("iarch_ledger").add({
                    p: params[0].trim(), c: params[1].trim(), v: params[2].trim(), s: 'w',
                    date: `${new Date().getMonth()+1}/${new Date().getDate()}`,
                    fullDate: new Date().toISOString()
                });
                document.getElementById('cmd-palette').style.display = 'none';
                e.target.value = '';
            }
        }
    });
</script>
</body>
</html>
